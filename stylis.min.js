!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(global):"function"==typeof define&&define.amd?define(e(window)):window.stylis=e(window)}(function(e){"use strict";function i(e,i,r,t){var n="",s="",l=e.charCodeAt(0)||0;if(91===l){var a=e.substring(1,e.length-1).split("="),o=(s=a[1]).charCodeAt(0);34!==o&&39!==o||(s=s.substring(1,s.length-1)),n="["+a[0]+'="'+s+'"]'}else s=35===l||46===l||62===l?(n=e).substring(1):n=e;for(var f,g,d,h=void 0===r||r===!0?s:"",b=void 0!==t&&"function"==typeof t,c="",u="",v="",p="",m="",w=0,x=0,A=0,C=0,y=1,k=i.length,O=0,l=0,j=0,z=0,E=0,N="";x<k;){var R=i.charCodeAt(x);if(0!==E||123!==R&&125!==R&&59!==R)13===R||10===R?(2===z&&(c="",z=0),C=0,y++):9!==R&&(34===R?E=34===E?0:39===E?39:34:39===R?E=39===E?0:34===E?34:39:47===R&&47===R&&z<2&&z++,c+=i[x]);else{c+=i[x];var I=c.charCodeAt(0);32===I&&(I=(c=c.trim()).charCodeAt(0));var q=c.charCodeAt(1)||0,B=c.charCodeAt(2)||0;if(b&&(c=t(0,c,y,C)||c),2===z)125===R&&(z=0),c="";else if(64===I)if(107===q||103===q?107===q?(u=c.substring(1,11)+h+c.substring(11),c="@-webkit-"+u,l=1):c="":109===q&&(105===B?(void 0===g&&(g={}),u=(d=c.substring(7,c.indexOf("{"))+" ").trim(),d=d.substring(0,d.indexOf(" ")).trim(),g[d]={key:u.trim(),body:null},l=3,c="",u=""):l=2),105===q){if(110===B)if(c=c.substring(9,c.length-1),w=c.indexOf("("),w>-1){var D=c.substring(0,w),F=g[D],G=c.substring(D.length+1,c.length-1).split(","),H=F.key.replace(D,"").replace(/\(|\)/g,"").trim().split(",");c=F.body;for(var J=0,K=G.length;J<K;J++){var L=H[J].trim();void 0!==L&&(c=c.replace(new RegExp("\\"+L,"g"),G[J].trim()))}i+=c,k+=c.length,c=""}else c=g[c].body,0===A&&(i+=c,k+=c.length,c="");else if(109===B&&b){var M=/@import.*?(["'][^\.\n\r]*?["'];|["'].*\.scss["'])/g.exec(c);null!==M&&(c=t(3,M[1].replace(/['"; ]/g,""),y,C)||"",c&&(i+=c,k+=c.length),c="")}}else j=-1,O++;else if(36===I){var P=c.indexOf(":");void 0===f&&(f=[]),f[f.length]=[c.substring(0,P),c.substring(P+1,c.length-1).trim()],c=""}else{if(97===I&&110===q&&105===B){var P=c.indexOf(":")+1,Q=c.substring(0,P),S=c.substring(P).split(",");if(45!==(c.charCodeAt(9)||0))for(var T=0,K=S.length;T<K;T++){for(var U=S[T],V=U.split(" "),W=0,X=V.length;W<X;W++){var Y=V[W].trim();"infinite"!==Y&&"linear"!==Y&&"alternate"!==Y&&"normal"!==Y&&"forwards"!==Y&&"backwards"!==Y&&"both"!==Y&&"none"!==Y&&"ease"!==Y&&Y.indexOf("cubic-bezier(")===-1&&Y.indexOf("ease-")===-1&&isNaN(parseInt(Y))&&(V[W]=h+Y,U=V.join(" "))}Q+=(0===T?"":",")+U.trim()}else Q+=(110!==(c.charCodeAt(10)||0)?"":h)+S[0].trim();c="-webkit-"+Q+Q}else if(97===I&&112===q&&112===B)c="-webkit-"+c+"-moz-"+c+c;else if(104===I&&121===q&&112===B||117===I&&115===q&&101===B)c="-webkit-"+c+"-moz-"+c+"-ms-"+c+c;else if(102===I&&108===q&&101===B||111===I&&114===q&&100===B)c="-webkit-"+c+c;else if(116===I&&114===q&&97===B)c="-webkit-"+c+(102===c.charCodeAt(5)?"-ms-"+c:"")+c;else if(100===I&&105===q&&115===B)c.indexOf("flex")>-1&&(c="display:-webkit-flex; display:flex;");else if(123===R){if(A++,0===O||2===l)if(2===A){x++;for(var Z="",$=c.substring(0,c.length-1).split(","),_=v.substring(0,v.length-1).split(","),ee=1;x<k;){var o=i.charCodeAt(x);if(123===o?ee++:125===o&&ee--,0===ee)break;Z+=i[x++]}for(var T=0,K=_.length;T<K;T++){var ie=_[T];_[T]="";for(var W=0,X=$.length;W<X;W++)_[T]+=(ie.replace(n,"").trim()+" "+$[W].trim()).trim()+(W===X-1?"":",")}k+=(i+=("\n"+_.join(",")+"{"+Z+"}").replace(/&| +&/g,"")).length,c="",A--}else{for(var re=c.split(","),Q="",T=0,K=re.length;T<K;T++){var e=re[T],te=e.charCodeAt(0);if(32===te&&(te=(e=e.trim()).charCodeAt(0)),91===te)for(var W=T+1,X=K-T;W<X;W++){var ne=(e+=","+re[W]).trim();if(93===ne.charCodeAt(ne.length-1)){K-=W,re.splice(T,W);break}}if(38===te)e=n+e.substring(1);else if(58===te){var se=e.charCodeAt(1);if(104===se&&116===e.charCodeAt(4)){var le=(e=e.substring(5)).charCodeAt(0);e=40===le?n+e.substring(1).replace(")",""):45===le?e.substring(9,e.indexOf(")"))+" "+n+" {":n+e}else e=103===se?e.substring(8).replace(")",""):n+e}else e=n+" "+e;Q+=0===T?e:","+e}v=c=Q}}else 125===R&&0!==A&&A--;0!==O?(125===R?j++:123===R&&0!==j&&j--,0===j?(0===l?c="":1===l?(c="}@"+u+"}",u=""):2===l?(0!==u.length&&(c=n+" {"+u+"}"+c),u=""):3===l&&(g[d].body=u,d="",c="",u=""),l=0,j--,O--):1===l||3===l?(u+=c,3===l&&(c="")):2===l&&0===A&&125!==R&&(u+=c,c="")):0===A&&125!==R&&(p+=c,c="")}m+=c,c="",125===R&&0===l&&0===z&&(b&&0!==m.length&&(m=t(1,m,y,C)||m),N+=m,m="")}x++,C++}if(0!==p.length&&(p=n+" {"+p+"}",b&&(p=t(2,p,y,C)||p),N+=p),void 0!==f)for(var J=0,X=f.length;J<X;J++)N=N.replace(new RegExp("\\"+f[J][0],"g"),f[J][1]);return N}return i});