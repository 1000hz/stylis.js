<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>stylis.js example</title>
	<script src='../stylis.js'></script>
</head>
<body>
	<script>
		disableTests = true;

		(function () {

			// console.log(
			// 	stylis(`.abc`, `
			// 		.logo {
			// 			animation: 1s slidein cubic-bezier(0.1,0.7,1.0,0.1);
			// 			animation-timing-function: cubic-bezier(0.1,0.7,1.0,0.1);
			// 		}
			// 	`)
			// )

			// return;

			// console.log(
			// 	stylis('.abc', `
			// 		@custom-selector:--button button, .button;
			// 		@custom-selector:--enter :hover, :focus;

			// 		:--button {
			// 			color: red;
			// 		}

			// 		:--button:--enter {
			// 			color: red;
			// 		}
			// 	`, true, true, null)
			// )

			// return;

			// console.log(stylis('.abc', `
			// 	@font-face { 
			// 		font-family: Pangolin; 
			// 		src: url('Pangolin-Regular.ttf') format('truetype');
			// 	}

			// 	// h1, div {
			// 	// 	color: red;

			// 	// 	h2, 
			// 	// 	&:before {
			// 	// 		color: red;
			// 	// 	}
			// 	// }

			// 	// .root & {
			// 	//     width: 1px;

			// 	//     &:hover {
			// 	//         color: black;
			// 	//     }
			// 	// }
			// `))

			// return;

function middleware (ctx, str, line, col, prefix) {

if (ctx === 1.5) {
	// stylis does not prefix `:global()`
	if (str.indexOf(prefix) === 0 && str.indexOf(' ') !== -1) {
		// remove prefix
		str = str.substring(prefix.length).trim();

		var indexOf;

		// single selector
		if (str.indexOf(' ') !== -1) {
			return str.replace(/^[^ \t]*?\[.*?\]|[^ \n\r\t\+\~\>]+|.+\]/g, function (match) {
				// :hover etc...
				if ((indexOf = match.indexOf(':')) !== -1) {
					// :global()
					if (match.charCodeAt(indexOf+1) === 103) {
						return match.replace(/:global\((.*)\)/g, '$1').trim();
					}
					else {
						return match.substring(0, indexOf) + prefix + match.substring(indexOf);
					}
				}
				else {
					return match + prefix;
				}
			});
		}
		else {
			console.log(1, str);

			if ((indexOf = str.indexOf(':')) !== -1) {
				return str.substring(0, indexOf) + prefix + str.substring(indexOf);
			}
			else {
				return str + prefix;
			}
		}
	}
}

}

			var css = `
// p:hover {
//   color: red;
// }

// p::before {
//   color: red;
// }

// :hover p {
//   color: red;
// }

// h1 :global(div:not(.foo)) {
// 	color: red;
// }

// @global {
// 	h1 {
// 		color: red;

// 		h2 {
// 			color: blue;
// 		}
// 	}
// }

// @global {
// 	@media (min-width: 64em) {
// 		html {font-size: 12px;}
// 	}

// 	p {
// 		color: red;
// 	}

// 	@media (min-width: 24em) {
// 		html {font-size: 12px;}
// 	}

// 	@keyframes {
// 		0% {
// 			color: red;
// 		}
// 		100% {
// 			color: blue;
// 		}
// 	}
// }

// h1 {
// 	color: red;
// }

// h1 h2 {
//   margin: auto
// }

				// h1, h2:hover h2, span :global(p){
				// 	color: red;
				// }

				// h1, [title="hello world"] {
				// 	color: red;
				// }

				// div {
				// 	display: flex;

				// 	h1 {
				// 		color: red;
				// 	} 
				// }
			`;

var css = `
a {
	&:global(.active) {
    	color: orange;
	}

	:global(.active) {
    	color: red;
	}

	div:global(.active) {
		color: blue;
	}
}

// :host-context(body) { 
// 	color: red; 
// }

// a, &:global(h1), :global(h1:not(foo)), :host-context(.foo), :host {
// 	color: blue;
// }

// div {
// 	h1 {
// 		color: red;
// 	}

// 	@media (10px) {
// 		h2 {
// 			color: red;
// 		}
// 	}

// 	@media (20px) {
// 		h2 {
// 			color: red;
// 		}
// 	}
// }
`;

			// stylis.use(middleware);

			var output = stylis(`.abc`, css, true, true, null);

			console.log(output);

			return;

			console.log(
				stylis('.abc', `

					a {
					  color: blue;

					  &:active,&:focus,
					  &:hover {
					    color: yellow;
					  }
					}
				
					// [title="a,b,d"], h1, [title="f,r,c"] {
				 //  		color: red
					// }

					// &.foo,&.baz { 
					// 	&.bar {
					// 		color: yesplease;
					// 	}
					// }

					// &.foo { 
					// 	&.bar { 
					// 		&.barbar {
					// 			color: yesplease;
					// 		}
					// 	}
					// }

					// h2 {
					// 	display: inline-flex;
					// }

					// h1 {
					// 	display: flex;
					// }
					
					// h1 {
					// 	background: url(http://url.com/});
					// }

					// div {
					// 	background: url(http://url.com//1234) '('; // sdsd
						
					// 	background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAABCAIAAADsEU8HAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVQI12P8//8/Aw4wbdq0rKysAZG1trbGJXv06FH8sgDIJBbBfp+hFAAAAABJRU5ErkJggg==");
					// }
				`)
					// .replace(/\{/g, '{\n\t')
					// .replace(/\}\./g, '}\n.')
					// .replace(/,/g, ',\n')
					// .replace(/\;/g, ';\n\t')
					// .replace(/\t\}/g, '}')
					// .replace(/url\([^\0]+?\)(?: |;)/g, function (match) {
					// 	return match.replace(/[\t\n]*/g, '');
					// })
			)

			return;

			// stylis.use('darken', function (value) {
			// 	console.log('darken', arguments);
			// 	return 'something';
			// });

			// stylis.use((ctx, str, line, col) => {
			// 	switch (ctx) {
			// 		case 2: {
			// 			console.log('random', str);
			// 			return 'something';
			// 		}
			// 	}
			// });

			// stylis.use([
			// 	(ctx, str, line, col) => {
			// 		switch (ctx) {
			// 			case 0: {
			// 				// console.log('begin', str);
			// 				break;
			// 			}
			// 			case 4: {
			// 				console.log('import', str);
			// 				return;
			// 			}
			// 			case 5: {
			// 				console.log(1, 'random', str);
			// 				// return 'something';
			// 			}
			// 		}
			// 	}
			// ])

			// var plugins = null;

			var plugins = {
				darken () {
					console.log('darken', arguments);
					return 'something';
				},
				random (value) {
					console.log('random', arguments, eval(value));
					return 'something';
				}
			};

			output = stylis('.abc', `
				@import "foo.js";

				/* this does not work */
				// .root :global(p + p) {
				//   color: green;
				// }

				/* this works */


				// color: red;
				// width: 100px;

				// @media {
				// 	color: red;

				// 	h1 {
				// 		color: red;

				// 		h2 {
				// 			color: orange;
				// 		}
				// 	}

				// 	color: blue;

				// 	div {color: red;}
				// }

				// h1 {
				// 	color: blue;

				// 	h2 {
				// 		color: red;

				// 		h3, h4 {
				// 			color: purple;
				// 		}
				// 	}
				// }

				// div {
				// 	color: orange;

				// 	span {
				// 		color: red;
				// 	}
				// }

				// color: blue;
				// height: 100px;

				h1 {
					color: darken(  #FFF, #CCC lol  );
					width: random(100*10);

					h2 {
						color: blue;
					}
				}

				// div {
				// 	color: red;
				// }
			`, false, false, plugins);

			console.log(output);

			return;

			// output = stylis('.abc', `
			// 	h1 {
			// 		animation: loading 1s ease infinite forwards;
			// 		animation-fill-mode: none;
			// 	}
			// `);

			// console.log(output);

			// return;

			output = stylis(``, `
			.namespace {
			  	.foo {
			  		color: red;
			  	}
			  	/* .namespace .foo */ 
			  	& .foo {
			  		color: red;
			  	}
			  	/* .namespace .foo */
			  	&.foo {
			  		color: red;
			  	}
			  	/* .namespace.foo */
			  	.foo & {
			  		color: red;
			  	}
		  		/* .foo .namespace */
			}

			// order: reverse;
			// align-items: center;
			// align-self: left;
			// align-content: left;

			// html &, & h1 {
			// 	color: red;
			// }

			// :host-context(body) { color: red; }
			// :host-context(body) h1 { color: red; }

			// :global(.html.something) & {
			// 	color: red;
			// }

			// .example {
			//     display: flex;
			// 	flex-direction: column;
			// 	align-items: center;
			// 	align: left;
			// }

			// h2, h1 {
			// 	background-color: blue;

		 //  		@media screen and (min-width: 250px) {
		 //  			background-color: red;
	  // 			}
			// }

			// html & {
			// 	color: red;
			// }

			// ~~selector: .user;

			// & {}

			// animation:0.6s infinite slidein cubic-bezier() ease-in-out linear alternate normal backwards forwards both none ease;
			// animation-name:slidein;
			// animation-duration:4s;

			// body.firefox var(~~selector):before {
			// 	content: "Hi, Firefox users!" var(~~selector);
			// }

			// .foo:before {
		 //  		content: ".hello {world} ' "
			// }

			// @mixin large-text {
		 //    	font-size: 20px;
			// }

			// @mixin linx (link, visit, hover, active) {
			// 	a {
			// 	    color: var(~~link);
			// 	    &:hover {
			// 	      color: var(~~hover);   
			// 	    }
			//   	}
			// }

			// @include large-text;
			
			// @include linx(white, blue, green, yellow);

			// & {
			// 	@include large-text;
			// }
		
			// @import "foo.scss";
			// @import "foo";
			// @import "foo", 'bar';
			// @import "foo/bar";

			// @import "foo.css";
			// @import "foo" screen;
			// @import "http://foo.com/bar";
			// @import "http://localhost";
			// @import url(foo);
				
			// @include linx(white, blue, green, red);

			// & { width: calc(random()*10); }
	
			// margin: calc(random()*10);

			// & { color: red; color: $foo; }

			// :hover {color:red;}
			// :host { color: red; }
			// :host(.fancy) { color: red; }
			// :host-context(body) { color: red; }
			// :root { color: red; }
			// div, :global(.bootstrap) { color: red; }

			// span, h1{
			// 	color: red;
	
			// 	h2 {
			// 		color: purple;
			// 	}

			// 	animation: slide 0.4s infinite;
	  //     		animation-duration: 0.6s;
	  //     		animation-name: slidein;
	  //     		animation-iteration-count: infinite;
		    // }

		    // @media (600px) {
		    // 	h1 {
		    // 		color: red;
		    // 		width: calc(random()*10)px;
		    // 	}
		    // }

		    // @keyframes in {
		    // 	0% {}
		    // 	100 % {}
		    // }
	

			// :global(p) { 
			// color: blue 
			// }

		    // #id {color: red;}
		    // .class {color: red;}
		    // [title=woot] {color: blue}

		 //    .nav li:not(:last-child) a {
			// 	margin-right: 16px;
			// }
		 //    a[title=github] {
			// 	font-weight: bold;
			// }

		 //    h4,
			// h5,
			// h6 { 
			// 	font-size: 18px; 
			// }
		`, true, true, function (ctx, str, line, col) {
			// var len = str.length-1;

			// this will by pass stylis and add prefix on it's own
			// if ((str[len] === '{') && str[0] !== '/' && str.indexOf('[data-id=woot]') === -1 && str.indexOf('@') === -1) {
			// 	var selector = str.substring(0, len).trim();
			// 	return selector.split(',').map(function (value) {
			// 		return value + '[data-id=woot]';
			// 	}).join(',') + ' {';
			// }

			// // import, if an import is return it is inserted
			if (ctx === 3) {
				return `.imported { color: orange; }`;
			}
		});

		console.log(output);


		// console.log(
		// 	stylis('#ns', `
		// 		[title="a,b,c, something"], h1 {
		// 	  		color: red
		// 		}
		// 	`)
		// )

		// console.log(stylis('.abc', `
		// 	@media (max-width: 600px) {
		// 		color: red;	
		// 		h1 { color: red; }
		// 		display: none;
		// 	}
		// `))

		// console.log(stylis(`.foo`, `
		// 	h1 {
		// 		h2 {
		// 			color: blue;
		// 		}
		// 	}
		// `))
		})();
	</script>

	<script src='./index.js'></script>
</body>
</html>