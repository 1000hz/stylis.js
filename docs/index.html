<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="description" content="stylis is a feature-rich css preprocessor">
		
		<title>stylis</title>
		
		<link rel="stylesheet" href="assets/style.css">
	</head>
	<body>
		<div class="header">
			<div class="wrap">
				<div class="logo">
					<a class="./">
					<img src="assets/logo.svg"></a>
				</div>
				<div class="nav">
					<ul>
						<li><a href="https://github.com/thysultan/stylis.js">Github</a></li>
						<li><a href="https://npmjs.com/package/stylis">NPM</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="welcome">
				<p>stylis is a feature-rich css preprocessor</p>
				<div class="code">
					<div spellcheck=false>
<pre contenteditable id=editor>
/* @namespace .user */

:global(h1) {
	font-size: 22px;
}

div {
	display: flex;

	h1 {
		color: red;
	} 
}

@media {
	h1 {
		color: red;
	}
}
</pre>
<pre id=output>
h1 { 
    font-size: 22px; 
}

#namespace div {
    display: -webkit-box; 
    display: -webkit-flex;
    display: -ms-flexbox; 
    display: flex;
}

#namespace div h1 {
	color: red;
}
</pre>
					</div>
				</div>
			</div>
		</div>
		
		<script src="https://unpkg.com/stylis@1.0.9/stylis.min.js"></script>
	
		<script>
			(function () {
				var editor = document.getElementById('editor');
				var output = document.getElementById('output');

				// simple syntax highlighter
				var highlight = {
					tabs: function (match) {
						return '\t' + match;
					},
					newlines: function (match, group) {
						return group + (group === '}' ? '\n\n' : '\n');
					},
					value: function (match, group) {
						return ': <span class=value>' + group.trim() + '</span>;';
					},
					selector: function (match, group) {
						return '<span class=selector>' + group.trim() + '</span> {\n';
					},
					block: function (match, group1, group2, group3) {
						return group1 + group2.split('\n').join('\n\t') + group3;
					}
				};

				function refresh (e) {
					if (e.keyCode === 9) {
						e.preventDefault();

			            var selection = window.getSelection();
			            var range = selection.getRangeAt(0); 
			            var text = document.createTextNode('\t');

			            range.deleteContents(); 
			            range.insertNode(text);
			            range.setStartAfter(text);
			            selection.removeAllRanges();
			            selection.addRange(range);

			            return;
					}

					var namespace = '#namespace';
					var raw = editor.textContent;
					var pragma = /\/\*.*@namespace (.*) \*\//g.exec(raw);

					if (pragma != null) {
						namespace = pragma[1].trim();
					}

					var processed = stylis(namespace, raw, true, true, null);

					processed = processed.replace(/(;|\})/g, highlight.newlines);
					processed = processed.replace(/(.*?)\{/g, highlight.selector);
					processed = processed.replace(/:(.*);/g, highlight.value);
					processed = processed.replace(/^.*;$/gm, highlight.tabs);
					processed = processed.replace(/\}\n\n\}/g, '}\n}');
					processed = processed.replace(/(.*@.*\{)([^\0]+\})(\n\})/g, highlight.block);

					output.innerHTML = processed;
				}

				function input (e) {
					refresh(e);
				}

				editor.addEventListener('keydown', refresh);
				editor.addEventListener('input', input);

				refresh({keyCode: 219, shiftKey: true});
			})();
		</script>
	</body>
</html>